<!DOCTYPE html>
<!--
    Based upon Striped 2.5 by HTML5 Up!
    html5up.net | @n33co
    Updated for Jekyll by Paul Fenwick | @pjf
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">
    <head prefix="og: http://ogp.me/ns#">
        <title>autodie status update</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        


    <meta property="og:image" content="http://pjf.id.au/images/pjf_square.jpg"  />
    <link rel="image_src"        href="http://pjf.id.au/images/pjf_square.jpg"  />


<meta property="og:title" content="autodie status update"  />
<meta property="og:url"   content="http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html" />

<!-- This should be expanded to allow for 'article' types -->
<meta property="og:type"  content="website" />




    <meta name="keywords" content="advogato" />



<meta property="fb:admins" content="549169610" />


        <link rel="icon" type="image/png" href="/images/favicon.png" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/>

        
            <link rel="alternate" type="application/rss+xml" title="All Comments" href="http://pjf.disqus.com/latest.rss"/>
        

        <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700|Open+Sans+Condensed:300,700" rel="stylesheet" />
        <script src="/js/jquery.min.js"></script>
        <script src="/js/skel.min.js"></script>
        <script src="/js/skel-panels.min.js"></script>
        <script src="/js/init.js"></script>
        <noscript>
            <link rel="stylesheet" href="/css/skel-noscript.css" />
            <link rel="stylesheet" href="/css/style.css" />
            <link rel="stylesheet" href="/css/style-desktop.css" />
            <link rel="stylesheet" href="/css/style-wide.css" />
        </noscript>
        <!--[if lte IE 9]><link rel="stylesheet" href="css/ie9.css" /><![endif]-->
        <!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="css/ie8.css" /><![endif]-->
        <!--[if lte IE 7]><link rel="stylesheet" href="css/ie7.css" /><![endif]-->

        <!-- TODO: Only load on fancybox pages -->
<link rel="stylesheet" href="/fancybox/source/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


        <link rel="stylesheet" href="/css/pygments.css" />
        <link rel="stylesheet" href="/css/pjf.css" />

    </head>
    <!--
        Note: Set the body element's class to "left-sidebar" to position the sidebar on the left.
        Set it to "right-sidebar" to, you guessed it, position it on the right.
    -->
    <body class="left-sidebar">
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47199716-1']);
  _gaq.push(['_gat._anonymizeIp']); // Better user privacy
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    

<p class="h-card hidden">
    <img class="u-photo" src="/images/pjf_square.jpg" alt=""/>
    <a class="p-name u-url" href="http://pjf.id.au">paul.j.fenwick</a>
</p>

        <div id="wrapper">
            <div id="content">
                <div id="content-inner">
                    
    


<article class="is-post h-entry">
    <header>
    

    <h2 class="p-name">autodie status update</h2>
    
        <!-- This makes G+ bots happy -->
        <span class="byline">By Paul Fenwick</span>
    
    <p class="edit-post">
(You can <a href="https://github.com/pjf/pjf.github.io/edit/build/advogato/_posts/2009-05-01-autodie-status-update.html">suggest changes</a>
to this post.)
</p>


</header>

    <div class="info">
    
    <a href="http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html" class="u-url nodecorate">
        <time class="date dt-published" datetime="2009-05-01 07:33:17"> <span class="month">May</span>
            <span class="day"> 1</span>
            <span class="year"><span>,</span> 2009</span>
        </time>
    </a>


    <!-- Note: You can change the number of list items in "stats" to whatever you want. -->

    <!--
        <ul class="stats">
            <li><a href="#" class="fa fa-comment">16</a></li>
            <li><a href="#" class="fa fa-heart">32</a></li>
            <li><a href="#" class="fa fa-twitter">64</a></li>
            <li><a href="#" class="fa fa-facebook">128</a></li>
        </ul>
    -->
</div>


    

    <div class="e-content">
        <p><b>autodie status update</b><br>
I just looked through my blog history, and discovered the last release of <a href="http://search.cpan.org/perldoc?autodie">autodie</a>, I've blogged about was version 1.99!  Since then, there's been nine releases!  For those of you new to my blog, autodie is a lexical pragma that allows Perl's built-ins to throw exceptions on failure, which can take your error-handling from cumbersome to simple.
<p>
There's been a lot of changes in those nine releases, and the <a href="http://github.com/pfenwick/autodie/tree/master/Changes">Changes</a> file documents all the significant ones.  There are nicer error messages, better coverage of Perl's core functions, fewer rough edges, and lots more tests.  If you're not one to go reading Changes files, I can assure you that upgrading to 1.999 is pleasant and surprise-free.
<p>
I've had a few people tease me about the silly version number, 1.999 threatens to have 1.9991 as a next release, but this will not happen.  The next version of autodie will be 2.000, and this actually represents a significant change.  There's no backwardly incompatible changes, but there is a new feature which greatly extends autodie's ability to detect failures in non-core subroutines.
<p>
Presently, one can write:

<pre>
    use File::Copy qw(copy);
    use autodie qw(copy);

    copy($src, $dst);
</pre>
<p>
If anything goes wrong, autodie spots it, throws an exception, and tells you file, line-number, source and destination files, and the error that occurred.  Brilliant.  However, one day, someone tried this:

<pre>
    my @array = copy($src,$dst);
</pre>
<p>
Given that <tt>copy</tt> is going to succeed or die, I don't know why one would want to examine its return value as a list, but they did.  The surprise here is that it <i>didn't</i> die on failure.  It just silently ignored them.
<p>
The problem is in how autodie 1.9x currently determines failure from a user subroutine.  In a scalar context, it considers a false value to be a failure, and in a list context it considers failure to be an empty list, or a list consisting of a single undefined value.  The problem was that <tt>copy</tt> would return a list consisting of a single zero when called in list context[1], and that looked like a perfectly normal (success) value to autodie.
<p>
This is actually symptomatic of a deeper problem, which is that except when an exception is thrown, there are too many ways people try to signal failure in Perl.  Why, just last week I saw code that did this:

<pre>
    return( undef, "1.21 jigawatts needed for operation" );
</pre>
<p>
Yes, errors were signalled by returning a two-element list, the first of which was always undef, and the second of which was the error message.  The function could <i>also</i> return a list of values which you were interested in, and there may only be two of those, but the first <i>wouldn't</i> be undef.  To make things more fun, I've seen almost exactly the same signalling mechanism at a <i>different</i> client a few years back.
<p>
The only thing I haven't seen is anyone try to <i>handle</i> these failures, because they're such a pain in the arse to detect, nobody ever to tries.  That means that then when things go wrong, they go <i>badly</i> wrong.
<p>
So, autodie 2.00 will have a "hinting interface", whereby you can say that <i>these</i> subroutines signal failure by doing <i>this</i>.  The idea of hints are very simple: autodie smart-matches the return value against them, and if the result is true, a failure is considered to have occurred.  Since it's possible to smart-match against subroutines, you can check for anything you want.  The hint for the failure signalling shown above would look something like this:

<pre>
    sub { @_ == 2 and not defined $_[0] }
</pre>
<p>
I owe <a href="http://damian.conway.org/">Damian Conway</a> a particular thank-you for spending a great deal of his time discussing hinting interfaces with me, and convincing me that there are just so many different ways people try to signal errors, that autodie really has to be ready for anything.
<p>
The other change is that when we build our exception (which doesn't need to be of the default <a href="http://search.cpan.org/perldoc?autodie::exception">autodie::exception</a> class), it will also be passed the return value from the failing subroutine, which is useful not only for creating good-looking error messages, but which may also prove useful in logging and testing.
<p>
The actual hinting interface is described in more detail in <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-04/msg00482.html">my post to p5p</a> and the accompanying thread.  In brief, most end-users will <i>never</i> need to see nor worry about the hints, they'll Just Work.
<p>
All these changes will work on 5.8.x as well as 5.10.x, although there'll be a few minor limitations in 5.8.x, since I can't use a native smart-match under the hood.
<p>
The only thing I have to do now is finish writing the code, although there's a basic (but not yet final) working implementation on the <a href="http://github.com/pfenwick/autodie/tree/hints">hints branch</a> of my git repo.  The changes aren't actually that hard, I've just had lots of people throwing money at me recently to work on other projects.  Luckily, I've got four flights in the next two weeks, and for me travel time is usually coding time.
<p>
[1]<i>Actually, on Windows, File::Copy sometimes returns an empty string to signal failure, which makes things not only wrong, but inconsistently wrong!  I've written <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-04/msg00471.html">a patch for this</a>, but as I suspect I'm the only person this century to have noticed or cared, it hasn't been applied.</i>

    </div>

    <div class="share-container">
    <div class="share-buttons">
        <p>Share:</p>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
        <a href="https://twitter.com/intent/tweet?text=autodie status update (by @pjf):&amp;url=http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
        <a href="https://www.linkedin.com/shareArticle?url=http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
        <a href="https://plus.google.com/share?url=http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html&amp;hl=en-GB" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
        <a href="http://pinterest.com/pin/create/button/?url=http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html&amp;description=&amp;media=http://pjf.id.au" target="_blank"><i class="fa fa-pinterest-square fa-2x"></i></a>
    </div>
    <div class="share-buttons pull-right">
        <p>Subscribe:</p>
        
            <a href="https://twitter.com/pjf"><i class="fa fa-twitter-square fa-2x"></i></a>
        
        
            <a href="https://facebook.com/paul.fenwick"><i class="fa fa-facebook-square fa-2x"></i></a>
        
        <a href="/feed.xml"><i class="fa fa-rss-square fa-2x"></i></a>
    </div>
</div>


    

<div class="amplify">
    <i class="fa fa-quote-left fa-2x pull-left fa-border darker"></i>
    <h4><a href="http://bit.ly/1bABN6P">3 Myths That Block Progress For The Poor</a></h4>
    <p><a  href="http://bit.ly/1bABN6P" class="plain darker">
    The belief that the world can’t solve extreme poverty and disease isn’t
    just mistaken. It is harmful. &nbsp;&nbsp;</a>
    <a href="http://bit.ly/1bABN6P">Read more...</a>
    </p>
</div>


    

    
<div class="tip-box">
    <p>
        <img class="pull-right bitcoin" src="/images/bitcoin-qr.png" alt="Bitcoin QR code" />
        <a href="https://gittip.com/pjf"><i class="fa fa-gittip fa-3x pull-left"></i></a>
        This site is ad-free, and all my writing can be modified and re-used under
        a <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 license</a>.
        If you'd like to support my work, please 
        <a href="https://gittip.com/pjf">tip me on GitTip</a>,
        or <a href="bitcoin:1P9iGHMiQwRrnZuA6USp5PNSuJrEcH411f">donate via Bitcoin</a> (1P9iGHMiQwRrnZuA6USp5PNSuJrEcH411f).
    </p>
</div>



    

<div id="disqus_thread"></div>
<script type="text/javascript">

    var disqus_shortname  = "pjf"; 
    var disqus_identifier = "/advogato/2009/05/01/autodie-status-update.html";
    var disqus_title      = "autodie status update";
    var disqus_url        = "http://pjf.id.au/advogato/2009/05/01/autodie-status-update.html";

    /* Make sure that once disqus renders, we trigger any events that
     * need to happen on page resize. Otherwise our left-bar looks funny. */

    function disqus_config() {
        this.callbacks.onReady.push(function() {
            var $sc = $('#sidebar, #content');

if (skel.isActive('mobile') || skel.isActive('narrower'))
    $sc.css('min-height', '0').css('height', 'auto');
else
    $sc.css('min-height', $(window).height()).css('height', $(document).height());


        });

        this.callbacks.onNewComment.push(function() {
            var $sc = $('#sidebar, #content');

if (skel.isActive('mobile') || skel.isActive('narrower'))
    $sc.css('min-height', '0').css('height', 'auto');
else
    $sc.css('min-height', $(window).height()).css('height', $(document).height());


        });
    }

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</article>


                    


                </div>
            </div>

            <!-- Sidebar -->
<div id="sidebar">
    <!-- Logo -->
    <div id="logo"><h1><a href="/">pjf</a></h1></div>

    <section class="find_me">
    
        <a href="https://twitter.com/pjf" rel="me"><i class="fa fa-twitter-square  fa-3x"  ></i></a>
    
    
        <a href="https://facebook.com/paul.fenwick" rel="me"><i class="fa fa-facebook-square fa-3x"  ></i></a>
    
    
        <a href="https://github.com/pjf" rel="me"><i class="fa fa-github-square   fa-3x"  ></i></a>
    
    <br />
    
        <a href="https://flickr.com/photos/pfenwick" rel="me"><i class="fa fa-flickr fa-3x"></i></a>
    
    
        <a href="https://plus.google.com/+PaulFenwick" rel="me"><i class="fa fa-google-plus-square fa-3x"  ></i></a>
    
    <a href="/feed.xml"><i class="fa fa-rss-square fa-3x"></i></a>
    </section>

    <!-- Nav -->
    <nav id="nav">
        <ul>
            <!-- <li class="current_page_item"><a href="/"></a></li> -->
            <li><a href="/">Latest Posts</a></li>
        
            <li><a href="/talks">Talks</a></li>
        
            <li><a href="/ethics">Ethics</a></li>
        
            <li><a href="/tech">Technology</a></li>
        
            <li><a href="/depression">Depression</a></li>
        
            <li><a href="/df">Dwarf Fortress</a></li>
        
            <li><a href="/advogato">Older Posts</a></li>
        
        </ul>
    </nav>

    
        <section class="is-search">
            <form id="cse-search-box" action="http://google.com/cse">
            <input type="hidden" name="cx" value="partner-pub-5040518412301671:2427815553" />
            <input type="hidden" name="ie" value="UTF-8" />
            <input class="text" type="text" name="q" placeholder="Search" />
        </form>
        Search powered by Google.
        </section>
    

    <!-- Text -->
    <section class="is-text-style1">
        <div class="inner">
            <p>
            
                <a href="https://gittip.com/pjf">
                    <i class="fa fa-gittip fa-3x pull-left"></i>
                </a>
            
                Everything on this site is free for you to use
                under the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a> license.
            </p>
        </div>
    </section>

    <!-- Recent Posts -->
    <section class="is-recent-posts">
        <header>
            <h2>Recent Posts</h2>
        </header>

        <ul>
        
            <li><a href="/tech/2014/03/21/why-diversity-is-hard-to-achieve.html">Why diversity in tech is so hard to achieve</a>
        
            <li><a href="/tech/2014/03/06/exobrain-setup-is-now-even-easier.html">Exobrain setup is now even easier!</a>
        
            <li><a href="/tech/2014/02/25/the-ios-bug-is-worse-than-you-think.html">The iOS SSL/TLS bug is worse than you think</a>
        
            <li><a href="/tech/2014/02/22/how-i-claimed-270-of-beeminder-bounties.html">How I Claimed $270 of Beeminder Bounties</a>
        
            <li><a href="/personal/2014/02/17/is-social-media-making-us-antisocial.html">Is social media making us antisocial?</a>
        
            <li><a href="/personal/2014/02/14/bag-trashed-by-airport-staff.html">Bag Trashed By Airport Staff</a>
        
            <li><a href="/tech/2014/02/09/automate-your-life-with-exobrain.html">Automate Your Life With Exobrain</a>
        
            <li><a href="/personal/2014/02/07/remembering-aaron-swartz.html">Remembering Aaron Swartz</a>
        
            <li><a href="/ethics/2014/02/04/tolerance-now-maximises-sharehold-value.html">Tolerance, not bigotry, now maximises shareholder value</a>
        
            <li><a href="/ethics/2014/01/31/one-thing-can-make-the-world-a-better-place.html">One Thing Can Make The World A Better Place</a>
        
        </ul>
    </section>

    <!-- Recent Comments -->
    <!-- <section class="is-recent-comments">
        <header>
            <h2>Recent Comments</h2>
        </header>
        <ul>
            <li>case on <a href="#">Now Full Cyborg</a></li>
            <li>molly on <a href="#">Untitled Post</a></li>
            <li>case on <a href="#">Temporal Flux</a></li>
        </ul>
    </section> -->

    <!-- Calendar -->

    <!-- <section class="is-calendar">
        <div class="inner">
            <table>
                <caption>February 2013</caption>
                <thead>
                    <tr>
                        <th scope="col" title="Monday">M</th>
                        <th scope="col" title="Tuesday">T</th>
                        <th scope="col" title="Wednesday">W</th>
                        <th scope="col" title="Thursday">T</th>
                        <th scope="col" title="Friday">F</th>
                        <th scope="col" title="Saturday">S</th>
                        <th scope="col" title="Sunday">S</th>
                    </tr>
            </thead>
            <tbody>
                    <tr>
                        <td colspan="4" class="pad"><span>&nbsp;</span></td>
                        <td><span>1</span></td>
                        <td><span>2</span></td>
                        <td><span>3</span></td>
                    </tr>
                    <tr>
                        <td><span>4</span></td>
                        <td><span>5</span></td>
                        <td><a href="#">6</a></td>
                        <td><span>7</span></td>
                        <td><span>8</span></td>
                        <td><span>9</span></td>
                        <td><a href="#">10</a></td>
                    </tr>
                    <tr>
                        <td><span>11</span></td>
                        <td><span>12</span></td>
                        <td><span>13</span></td>
                        <td class="today"><a href="#">14</a></td>
                        <td><span>15</span></td>
                        <td><span>16</span></td>
                        <td><span>17</span></td>
                    </tr>
                    <tr>
                        <td><span>18</span></td>
                        <td><span>19</span></td>
                        <td><span>20</span></td>
                        <td><span>21</span></td>
                        <td><span>22</span></td>
                        <td><a href="#">23</a></td>
                        <td><span>24</span></td>
                    </tr>
                    <tr>
                        <td><a href="#">25</a></td>
                        <td><span>26</span></td>
                        <td><span>27</span></td>
                        <td><span>28</span></td>
                        <td class="pad" colspan="3"><span>&nbsp;</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section> -->

    <!-- Copyright -->
    <div id="copyright">
        <p>
            &copy; 2014 Paul Fenwick<br />
            Design: <a href="http://html5up.net/">HTML5 UP</a><br />
            Site Based On: <a href="https://github.com/pjf/pjf.github.io">pjf.github.io</a>
        </p>
    </div>
</div>

            
        </div>
    <!-- TODO: Only load on fancybox pages -->
<script type="text/javascript">
    $(document).ready(function() {
        $(".fancybox").fancybox({
            closeClick: true,
            closeBtn: false,
            arrows: false,
            mouseWheel: false,
        });
    });
</script>




    </body>
</html>

