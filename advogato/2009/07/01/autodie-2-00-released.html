<!DOCTYPE html>
<!--
    Based upon Striped 2.5 by HTML5 Up!
    html5up.net | @n33co
    Updated for Jekyll by Paul Fenwick | @pjf
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">
    <head prefix="og: http://ogp.me/ns#">
        <title>Autodie 2.00 released</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

        


    <meta property="og:image" content="http://pjf.id.au/images/pjf_square.jpg"  />
    <link rel="image_src"        href="http://pjf.id.au/images/pjf_square.jpg"  />


<meta property="og:title" content="Autodie 2.00 released"  />
<meta property="og:url"   content="http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html" />

<!-- This should be expanded to allow for 'article' types -->
<meta property="og:type"  content="website" />




    <meta name="keywords" content="advogato" />



<meta property="fb:admins" content="549169610" />


        <link rel="icon" type="image/png" href="/images/favicon.png" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/>

        
            <link rel="alternate" type="application/rss+xml" title="All Comments" href="http://pjf.disqus.com/latest.rss"/>
        

        <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700|Open+Sans+Condensed:300,700" rel="stylesheet" />
        <script src="/js/jquery.min.js"></script>
        <script src="/js/skel.min.js"></script>
        <script src="/js/skel-panels.min.js"></script>
        <script src="/js/init.js"></script>
        <noscript>
            <link rel="stylesheet" href="/css/skel-noscript.css" />
            <link rel="stylesheet" href="/css/style.css" />
            <link rel="stylesheet" href="/css/style-desktop.css" />
            <link rel="stylesheet" href="/css/style-wide.css" />
        </noscript>
        <!--[if lte IE 9]><link rel="stylesheet" href="css/ie9.css" /><![endif]-->
        <!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="css/ie8.css" /><![endif]-->
        <!--[if lte IE 7]><link rel="stylesheet" href="css/ie7.css" /><![endif]-->

        <!-- TODO: Only load on fancybox pages -->
<link rel="stylesheet" href="/fancybox/source/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


        <link rel="stylesheet" href="/css/pygments.css" />
        <link rel="stylesheet" href="/css/pjf.css" />

    </head>
    <!--
        Note: Set the body element's class to "left-sidebar" to position the sidebar on the left.
        Set it to "right-sidebar" to, you guessed it, position it on the right.
    -->
    <body class="left-sidebar">
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47199716-1']);
  _gaq.push(['_gat._anonymizeIp']); // Better user privacy
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


    

<p class="h-card hidden">
    <img class="u-photo" src="/images/pjf_square.jpg" alt=""/>
    <a class="p-name u-url" href="http://pjf.id.au">paul.j.fenwick</a>
</p>

        <div id="wrapper">
            <div id="content">
                <div id="content-inner">
                    
    


<article class="is-post h-entry">
    <header>
    

    <h2 class="p-name">Autodie 2.00 released</h2>
    
        <!-- This makes G+ bots happy -->
        <span class="byline">By Paul Fenwick</span>
    
    <p class="edit-post">
(You can <a href="https://github.com/pjf/pjf.github.io/edit/build/advogato/_posts/2009-07-01-autodie-2-00-released.html">suggest changes</a>
to this post.)
</p>


</header>

    <div class="info">
    
    <a href="http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html" class="u-url nodecorate">
        <time class="date dt-published" datetime="2009-07-01 15:40:20"> <span class="month">Jul</span>
            <span class="day"> 1</span>
            <span class="year"><span>,</span> 2009</span>
        </time>
    </a>


    <!-- Note: You can change the number of list items in "stats" to whatever you want. -->

    <!--
        <ul class="stats">
            <li><a href="#" class="fa fa-comment">16</a></li>
            <li><a href="#" class="fa fa-heart">32</a></li>
            <li><a href="#" class="fa fa-twitter">64</a></li>
            <li><a href="#" class="fa fa-facebook">128</a></li>
        </ul>
    -->
</div>


    

    <div class="e-content">
        <p><b>Autodie 2.00 released</b><br>
This weekend the long awaited <a href="http://search.cpan.org/perldoc?autodie">autodie 2.00</a> for
Perl was released to the CPAN, which was almost immediately replaced
by 2.02, which fixes some oopsed tests and which adds a couple more features to
give us a really sweet experience.  This blog entry assumes you're
using 2.02.
<p>
Observant viewers will notice that the major version number has
changed.  I've taken the great leap from 1.999 to 2.00.  Clearly,
something is different, and you might be wondering what.
<p>
Well, autodie 2.0 now supports a <a href="http://search.cpan.org/perldoc?autodie::hints">hinting
interface</a> for user-defined subroutines.  Put simply, if you have a
user-defined subroutine that does something funny to signify failure,
you can now tell autodie about that.  Once it knows, it can Do The
Right Thing when checking your subroutine.  You can even put the hints
into the same file as those subs, and if someone is using autodie
2.00, it will find the hints and use them.
<p>
This may not sound very exciting, but it is.  It means that a lot of
really ugly error-checking code, both on the CPAN and the DarkPAN, can
go away.  Lexically.  Still not convinced this will change your life?
Let's look a little more closely; trust me, you'll like it.
<p>
Let's pretend you're working on a piece of legacy code.  For some
reason, the people who wrote this code decided the best way to
signal errors is by returning the list <tt>(undef, "Error
message")</tt>.  I don't know why, but I've seen this anti-pattern
emerge independently in <i>three</i> 100k+ line projects I've been
involved in.

<pre>
sub some_sub {
    if ( not batteries_full() ) {
        return ( undef, "insufficient energy" );
    }

    if ( not coin_inserted() ) {
        return ( undef, "insufficient credit" );
    }

    my @results = some_calculation();

    return @results;
}
</pre>
<p>
If you want to check to see if <tt>some_sub()</tt> returns an error,
you need to capture its return values, look at the first one to see if
it's undefined, and if it's not, use the second one as your error.
At least, that's what you're <i>supposed</i> to do.
<p>
What actually happens is most developers decide that's way too hard,
and don't bother checking for errors.  Then one day, the batteries on
your doomsday-asteroid-destroying-satellite go flat, nobody notices,
and through an ironic twist of fate you're left as the last known human
survivor, and there are zombie hordes and walking killer plants
outside.
<p>
So, how can <a href="http://search.cpan.org/perldoc?autodie">autodie</a> help us?
Well, before version 2.00, it couldn't.  But now, with
<a href="http://search.cpan.org/perldoc?autodie::hints">autodie::hints</a>,
it can!  We can give autodie hints about how the return values are
checked.  They look like this:

<pre>
use autodie::hints;

autodie::hints-&gt;set_hints_for(
    'Some::Package::some_sub' =&gt; {
        scalar =&gt; sub { 1 },
        list   =&gt; sub { @_ == 2 and not defined $_[0] },
    },
);
</pre>
<p>
Our hints here are simple subroutines.  If they return true, our
subroutine has failed.  If they return false, it's executed
successfully.  Notice that our scalar hint always returns true.
That's because we consider any call of our subroutine in scalar
context to be a mistake.  It's returning a list of values, and
you should be checking that list.
<p>
Once we've set our hints, we can then use autodie to automatically
check if we're successful:

<pre>
use Some::Module qw(some_sub);

sub target_asteroid {

    use autodie qw( ! some_sub );

    # autodie has lexical scope, so only calls to some_sub inside
    # the target_asteroid subroutine are affected.

    my @results = some_sub();     # Succeeds or dies
}

sub target_ufo {
    my @results = some_sub();

    # autodie is out of lexical scope, so we have to manually
    # process @results here.
}

</pre>
<p>
If you're wondering what that exclamation mark means, it means "insist
on hints", and is a new piece of syntax with autodie 2.00.  If for any
reason autodie can't find the hints for <tt>some_sub</tt>, our code
won't compile.  That's a very good thing, and avoids us having a false
sense of security if we use autodie on an unhinted sub.
<p>
However the error messages from autodie aren't really that useful.
They're going to be things like <tt>"Can't some_sub() at
space_defense.pl line 53"</tt>.  There's a noticable lack of
explanation as to why <tt>some_sub()</tt> failed.
<p>
Luckily, since the way early versions of autodie, we've been able
to register message handlers.  And with the new features in autodie
2.02, we can produce very rich messages.  Let's see how!

<pre>
use autodie::exception;

autodie::exception-&gt;register(
    'Some::Module::some_sub' =&gt; sub {
        my ($error) = @_;

        if ($error-&gt;context eq "scalar") {
             return "some_sub() can't be called in a scalar context";
        }

        # $error-&gt;return gives a list of everything our failed sub
        # returned.  We know this particular sub puts the error
        # message the second argument (index 1).

        my $error_msg = $error-&gt;return-&gt;[1];

        return "some_sub() failed: $error_msg";
    }
);
</pre>
<p>
Now, whenever <tt>some_sub()</tt> fails, it'll print a genuinely
useful message, like <tt>"some_sub() failed: Insufficient energy at
space_defense.pl line 53"</tt>.  Yes, autodie automatically adds the
file and line number for you.  Nice!
<p>
But wait, there's more!  We don't want to see this sort of code
floating around in your programs.  You may be dealing
with other people's modules that you can't modify, so we can't hide
all this configuration in there.  So, we can <i>write our own
pragma</i> that contains all this info.  Here's the full
code for a theoretical <tt>my::autodie</tt> pragma, and is the exact
same code used by the <tt>t/blog_hints.t</tt> file in autodie's
test suite.

<pre>
package my::autodie;
use strict;
use warnings;

use base qw(autodie);
use autodie::exception;
use autodie::hints;

autodie::hints-&gt;set_hints_for(
    'Some::Module::some_sub' =&gt; {
        scalar =&gt; sub { 1 },
        list   =&gt; sub { @_ == 2 and not defined $_[0] }
    },
);

autodie::exception-&gt;register(
    'Some::Module::some_sub' =&gt; sub {
        my ($E) = @_;

        if ($E-&gt;context eq "scalar") {
            return "some_sub() can't be called in scalar context";
        }

        my $error = $E-&gt;return-&gt;[1];

        return "some_sub() failed: $error";
    }
);

1;
</pre>
<p>
It works exactly the same as regular autodie, except it also knows
how to handle <tt>some_sub()</tt>, and display good looking error
messages.  Here's how we'd use it:

<pre>
use Some::Module qw(some_sub);
use my::autodie qw( ! some_sub );

my @results = some_sub();  # Succeeds or dies with a useful error!
</pre>
<p>
There's a lot more you can do with autodie, and if you want to learn
more, I'd suggest coming to my talk at <a href="http://en.oreilly.com/oscon2009/public/schedule/detail/8165">OSCON</a> or <a href="http://yapceurope2009.org/ye2009/talk/2063">YAPC::EU</a>, where I'll be covering all this and more, with a distinctive Star Trek twist. ;)


    </div>

    <div class="share-container">
    <div class="share-buttons">
        <p>Share:</p>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
        <a href="https://twitter.com/intent/tweet?text=Autodie+2.00+released (by @pjf):&amp;url=http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
        <a href="https://www.linkedin.com/shareArticle?url=http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
        <a href="https://plus.google.com/share?url=http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html&amp;hl=en-GB" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
        <a href="http://pinterest.com/pin/create/button/?url=http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html&amp;description=&amp;media=http://pjf.id.au" target="_blank"><i class="fa fa-pinterest-square fa-2x"></i></a>
    </div>
    <div class="share-buttons pull-right">
        <p>Subscribe:</p>
        
            <a href="https://twitter.com/pjf"><i class="fa fa-twitter-square fa-2x"></i></a>
        
        
            <a href="https://facebook.com/paul.fenwick"><i class="fa fa-facebook-square fa-2x"></i></a>
        
        <a href="/feed.xml"><i class="fa fa-rss-square fa-2x"></i></a>
    </div>
</div>


    

<div class="amplify">
    <i class="fa fa-quote-left fa-2x pull-left fa-border darker"></i>
    <h4><a href="http://www.gatesfoundation.org/Who-We-Are/Resources-and-Media/Annual-Letters-List/Annual-Letter-2014">3 Myths That Block Progress For The Poor</a></h4>
    <p><a  href="http://www.gatesfoundation.org/Who-We-Are/Resources-and-Media/Annual-Letters-List/Annual-Letter-2014" class="plain darker">
    The belief that the world can’t solve extreme poverty and disease isn’t
    just mistaken. It is harmful. &nbsp;&nbsp;</a>
    <a href="http://www.gatesfoundation.org/Who-We-Are/Resources-and-Media/Annual-Letters-List/Annual-Letter-2014">Read more...</a>
    </p>
</div>


    

    
<div class="tip-box">
    <p>
        <img class="pull-right bitcoin" src="/images/bitcoin-qr.png" alt="Bitcoin QR code" />
        <a href="https://gittip.com/pjf"><i class="fa fa-gittip fa-3x pull-left"></i></a>
        This site is ad-free, and all text, style, and code may be re-used under
        a <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 license</a>.
        If you'd like to support my work, please 
        <a href="https://gittip.com/pjf">tip me on GitTip</a>,
        or <a href="bitcoin:1P9iGHMiQwRrnZuA6USp5PNSuJrEcH411f">donate via Bitcoin</a> (1P9iGHMiQwRrnZuA6USp5PNSuJrEcH411f).
    </p>
</div>



    

<div id="disqus_thread"></div>
<script type="text/javascript">

    var disqus_shortname  = "pjf"; 
    var disqus_identifier = "/advogato/2009/07/01/autodie-2-00-released.html";
    var disqus_title      = "Autodie 2.00 released";
    var disqus_url        = "http://pjf.id.au/advogato/2009/07/01/autodie-2-00-released.html";

    /* Make sure that once disqus renders, we trigger any events that
     * need to happen on page resize. Otherwise our left-bar looks funny. */

    function disqus_config() {
        this.callbacks.onReady.push(function() {
            var $sc = $('#sidebar, #content');

if (skel.isActive('mobile') || skel.isActive('narrower'))
    $sc.css('min-height', '0').css('height', 'auto');
else
    $sc.css('min-height', $(window).height()).css('height', $(document).height());


        });

        this.callbacks.onNewComment.push(function() {
            var $sc = $('#sidebar, #content');

if (skel.isActive('mobile') || skel.isActive('narrower'))
    $sc.css('min-height', '0').css('height', 'auto');
else
    $sc.css('min-height', $(window).height()).css('height', $(document).height());


        });
    }

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




</article>


                    


                </div>
            </div>

            <!-- Sidebar -->
<div id="sidebar">
    <!-- Logo -->
    <div id="logo"><h1><a href="/">pjf</a></h1></div>

    <section class="find_me">
    
        <a href="https://twitter.com/pjf" rel="me"><i class="fa fa-twitter-square  fa-3x"  ></i></a>
    
    
        <a href="https://facebook.com/paul.fenwick" rel="me"><i class="fa fa-facebook-square fa-3x"  ></i></a>
    
    
        <a href="https://github.com/pjf" rel="me"><i class="fa fa-github-square   fa-3x"  ></i></a>
    
    <br />
    
        <a href="https://flickr.com/photos/pfenwick" rel="me"><i class="fa fa-flickr fa-3x"></i></a>
    
    
        <a href="https://plus.google.com/+PaulFenwick" rel="me"><i class="fa fa-google-plus-square fa-3x"  ></i></a>
    
    <a href="/feed.xml"><i class="fa fa-rss-square fa-3x"></i></a>
    </section>

    <!-- Nav -->
    <nav id="nav">
        <ul>
            <!-- <li class="current_page_item"><a href="/"></a></li> -->
            <li><a href="/">Latest Posts</a></li>
        
            <li><a href="/talks">Talks</a></li>
        
            <li><a href="/ethics">Ethics</a></li>
        
            <li><a href="/tech">Technology</a></li>
        
            <li><a href="/depression">Depression</a></li>
        
            <li><a href="/df">Dwarf Fortress</a></li>
        
            <li><a href="/advogato">Older Posts</a></li>
        
        </ul>
    </nav>

    
        <section class="is-search">
            <form id="cse-search-box" action="http://google.com/cse">
            <input type="hidden" name="cx" value="partner-pub-5040518412301671:2427815553" />
            <input type="hidden" name="ie" value="UTF-8" />
            <input class="text" type="text" name="q" placeholder="Search" />
        </form>
        Search powered by Google.
        </section>
    

    <!-- Text -->
    <section class="is-text-style1">
        <div class="inner">
            <p>
            
                <a href="https://gittip.com/pjf">
                    <i class="fa fa-gittip fa-3x pull-left"></i>
                </a>
            
            All text, style, and code on this website is free for you to use
            under the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a> license.
            </p>
        </div>
    </section>

    <!-- Recent Posts -->
    <section class="is-recent-posts">
        <header>
            <h2>Recent Posts</h2>
        </header>

        <ul>
        
            <li><a href="/personal/2015/07/29/noirin.html">Noirin</a>
        
            <li><a href="/tech/2015/04/05/the-past-and-future-ckan.html">The Past and Future CKAN</a>
        
            <li><a href="/tech/2015/03/12/ckan-infrastructure-sponsor-needed.html">CKAN needs an infrastructure sponsor!</a>
        
            <li><a href="/tech/2015/02/15/why-non-code-contributions-matter.html">Why non-code contributions matter</a>
        
            <li><a href="/ethics/2014/10/03/why-ban-the-burqa-doesnt-hold.html">Why "Ban the Burqa" Doesn't Hold</a>
        
            <li><a href="/personal/2014/09/03/do-what-you-love.html">Thoughts from Burning Man: Do what you love.</a>
        
            <li><a href="/tech/2014/06/22/gittip-and-osbridge.html">Gittip and Open Source Bridge</a>
        
            <li><a href="/tech/2014/06/21/gittip-and-diversity.html">On Gittip and Diversity</a>
        
            <li><a href="/personal/2014/05/27/on-privilege.html">On privilege</a>
        
            <li><a href="/ethics/2014/05/05/a-utilitarian-fable.html">A Utilitarian Fable</a>
        
        </ul>
    </section>

    <!-- Recent Comments -->
    <!-- <section class="is-recent-comments">
        <header>
            <h2>Recent Comments</h2>
        </header>
        <ul>
            <li>case on <a href="#">Now Full Cyborg</a></li>
            <li>molly on <a href="#">Untitled Post</a></li>
            <li>case on <a href="#">Temporal Flux</a></li>
        </ul>
    </section> -->

    <!-- Calendar -->

    <!-- <section class="is-calendar">
        <div class="inner">
            <table>
                <caption>February 2013</caption>
                <thead>
                    <tr>
                        <th scope="col" title="Monday">M</th>
                        <th scope="col" title="Tuesday">T</th>
                        <th scope="col" title="Wednesday">W</th>
                        <th scope="col" title="Thursday">T</th>
                        <th scope="col" title="Friday">F</th>
                        <th scope="col" title="Saturday">S</th>
                        <th scope="col" title="Sunday">S</th>
                    </tr>
            </thead>
            <tbody>
                    <tr>
                        <td colspan="4" class="pad"><span>&nbsp;</span></td>
                        <td><span>1</span></td>
                        <td><span>2</span></td>
                        <td><span>3</span></td>
                    </tr>
                    <tr>
                        <td><span>4</span></td>
                        <td><span>5</span></td>
                        <td><a href="#">6</a></td>
                        <td><span>7</span></td>
                        <td><span>8</span></td>
                        <td><span>9</span></td>
                        <td><a href="#">10</a></td>
                    </tr>
                    <tr>
                        <td><span>11</span></td>
                        <td><span>12</span></td>
                        <td><span>13</span></td>
                        <td class="today"><a href="#">14</a></td>
                        <td><span>15</span></td>
                        <td><span>16</span></td>
                        <td><span>17</span></td>
                    </tr>
                    <tr>
                        <td><span>18</span></td>
                        <td><span>19</span></td>
                        <td><span>20</span></td>
                        <td><span>21</span></td>
                        <td><span>22</span></td>
                        <td><a href="#">23</a></td>
                        <td><span>24</span></td>
                    </tr>
                    <tr>
                        <td><a href="#">25</a></td>
                        <td><span>26</span></td>
                        <td><span>27</span></td>
                        <td><span>28</span></td>
                        <td class="pad" colspan="3"><span>&nbsp;</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section> -->

    <!-- Copyright -->
    <div id="copyright">
        <p>
            &copy; 2014 Paul Fenwick<br />
            Design: <a href="http://html5up.net/">HTML5 UP</a><br />
            Site Based On: <a href="https://github.com/pjf/pjf.github.io">pjf.github.io</a>
        </p>
    </div>
</div>

            
        </div>
    <!-- TODO: Only load on fancybox pages -->
<script type="text/javascript">
    $(document).ready(function() {
        $(".fancybox").fancybox({
            closeClick: true,
            closeBtn: false,
            arrows: false,
            mouseWheel: false,
        });
    });
</script>




    </body>
</html>

